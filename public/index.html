<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FB Recovery Checker</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    body {
      background-color: #1c1c1e;
      color: #f1f1f1;
      font-family: "Segoe UI", sans-serif;
    }
    .card {
      border-radius: 1rem;
      background-color: #2c2c2e;
      border: 1px solid #3a3a3c;
    }
    #log {
      font-family: 'Courier New', monospace;
      background: #000;
      color: #0f0;
      padding: 15px;
      height: 400px;
      overflow-y: auto;
      border-radius: 0.5rem;
      font-size: 0.9rem;
    }
    .badge {
      font-size: 1rem;
    }
    .btn {
      min-width: 100px;
    }
    .progress-bar {
      transition: width .3s ease;
    }
    .text-muted { color: #aaa !important; }
    @media (max-width: 576px) {
      .d-flex.flex-wrap {
        flex-direction: column !important;
        gap: 0.5rem !important;
      }
      #log { height: 250px; }
    }
  </style>
</head>
<body>
<div class="container py-5">

  <div class="text-center mb-5">
  <h1 class="text-center ">BounceBack</h1>
  <p class="text-gray">Unmask recovery vectors — safely.</p>


  </div>

  <!-- 1. Upload numbers -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <h5 class="mb-3 text-white">1. Upload numbers.txt</h5>
      <form id="uploadForm" enctype="multipart/form-data" class="d-flex flex-column flex-sm-row gap-2">
        <input type="file" name="numbers" accept=".txt" required class="form-control"/>
        <button type="submit" class="btn btn-primary">Upload</button>
      </form>
      <div id="uploadStatus" class="mt-2 text-truncate text-info"></div>
    </div>
  </div>

  <!-- 1b. Upload proxy -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <h5 class="mb-3 text-white">2. Upload proxy.txt <small class="text-muted">(optional – one per line)</small></h5>
      <form id="proxyForm" enctype="multipart/form-data" class="d-flex flex-column flex-sm-row gap-2">
        <input type="file" name="proxy" accept=".txt" class="form-control"/>
        <button type="submit" class="btn btn-outline-light">Upload Proxy</button>
      </form>
      <div id="proxyStatus" class="mt-2 text-truncate text-info"></div>
    </div>
  </div>

  <!-- 2. Proxy toggle + Control + PROGRESS -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body d-flex flex-column gap-3">

      <!-- Toggle + Buttons + Stats -->
      <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" id="useProxy">
          <label class="form-check-label text-white" for="useProxy">Run with proxy</label>
        </div>

        <div class="d-flex gap-2 flex-wrap">
          <button id="startBtn" class="btn btn-success" disabled>Start</button>
          <button id="stopBtn"  class="btn btn-danger" disabled>Stop</button>
        </div>

        <div class="d-flex align-items-center gap-2 flex-wrap">
          <span class="badge bg-info">Valid: <span id="validCount">0</span></span>
          <a id="downloadBtn" class="btn btn-info btn-sm" style="display:none" download>Download valid.txt</a>
        </div>
      </div>

      <!-- Progress Bar -->
      <div class="w-100">
        <div class="d-flex justify-content-between mb-1">
          <small class="text-muted">Progress</small>
          <small class="text-muted"><span id="progNum">0</span> / <span id="progTotal">0</span></small>
        </div>
        <div class="progress" style="height: 1.4rem;">
          <div id="progBar" class="progress-bar progress-bar-striped progress-bar-animated bg-success"
               role="progressbar" style="width:0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
            0%
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- 3. Log -->
  <div class="card shadow-sm">
    <div class="card-body">
      <h5 class="mb-3 text-white">Live Log</h5>
      <pre id="log" class="text-monospace">Ready...</pre>
    </div>
  </div>

</div>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();
  const logEl = document.getElementById('log');
  const validEl = document.getElementById('validCount');
  const downloadBtn = document.getElementById('downloadBtn');
  const useProxyChk = document.getElementById('useProxy');
  const startBtn = document.getElementById('startBtn');
  const stopBtn = document.getElementById('stopBtn');
  const uploadStatus = document.getElementById('uploadStatus');

  function addLog(msg) {
    const line = document.createElement('div');
    line.textContent = '> ' + msg;
    logEl.appendChild(line);
    logEl.scrollTop = logEl.scrollHeight;
  }

  function clearLog() {
    logEl.innerHTML = '';
    addLog('Log cleared for new run...');
  }

  socket.on('log', addLog);
  socket.on('validCount', count => {
    validEl.textContent = count;
    downloadBtn.style.display = count > 0 ? 'inline-block' : 'none';
    if (count > 0) {
      downloadBtn.href = '/downloads/valid.txt?t=' + Date.now();
    }
  });

  socket.on('progress', ({done, total}) => {
    const percent = total ? Math.round((done / total) * 100) : 0;
    document.getElementById('progNum').textContent = done;
    document.getElementById('progTotal').textContent = total;
    const bar = document.getElementById('progBar');
    bar.style.width = percent + '%';
    bar.setAttribute('aria-valuenow', percent);
    bar.textContent = percent + '%';
  });

  socket.on('startRun', ({total}) => {
    clearLog();
    addLog('=== NEW RUN STARTED ===');
    addLog(`Loaded ${total} numbers. Starting 5 parallel workers...`);
    startBtn.disabled = true;
    stopBtn.disabled = false;
    document.getElementById('progNum').textContent = '0';
    document.getElementById('progTotal').textContent = total;
    const bar = document.getElementById('progBar');
    bar.style.width = '0%';
    bar.textContent = '0%';
  });

  socket.on('runComplete', () => {
    addLog('=== RUN COMPLETED ===');
    startBtn.disabled = false;
    stopBtn.disabled = true;
  });

  // Upload numbers
  document.getElementById('uploadForm').onsubmit = async e => {
    e.preventDefault();
    const data = new FormData(e.target);
    const res = await fetch('/upload', {method:'POST', body:data});
    const json = await res.json();
    const msg = json.message || json.error;
    uploadStatus.textContent = msg;
    uploadStatus.className = 'mt-2 text-truncate ' + (json.success ? 'text-success' : 'text-danger');
    
    if (json.success) {
      startBtn.disabled = false;
      addLog('numbers.txt uploaded and ready.');
    }
  };

  // Upload proxy
  document.getElementById('proxyForm').onsubmit = async e => {
    e.preventDefault();
    const data = new FormData(e.target);
    const res = await fetch('/upload-proxy', {method:'POST', body:data});
    const json = await res.json();
    const msg = json.message || json.error;
    document.getElementById('proxyStatus').textContent = msg;
    document.getElementById('proxyStatus').className = 'mt-2 text-truncate ' + (json.success ? 'text-success' : 'text-danger');
  };

  // Start / Stop
  startBtn.onclick = () => {
    socket.emit('start', { useProxy: useProxyChk.checked });
  };
  stopBtn.onclick = () => {
    socket.emit('stop');
    addLog('Stop requested...');
  };

  // Initial state
  addLog('Client connected. Upload numbers.txt to begin.');
</script>
</body>
</html>